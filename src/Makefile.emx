# Main Makefile for GNU m4.
# Copyright (C) 1992 Free Software Foundation, Inc.

os2release:
	$(MAKE) all -f Makefile.emx \
	CC="gcc -Zomf -O" O=".obj" A=".lib" \
	AR="emxomfar" RANLIB="emxomfar s" \
	LFLAGS="-s -Zcrtdll -Zstack 512" LIBS="../lib/regex.lib"
w32release:
	$(MAKE) all -f Makefile.emx \
	CC="gcc -Zwin32 -Zcrtdll=crtrsxnt -O" O=".o" A=".a" \
	AR="ar" RANLIB="ar s" LFLAGS="-s -Zstack 512"
os2debug:
	$(MAKE) all -f Makefile.emx \
	CC="gcc -g" O=".o" A=".a" AR="ar" RANLIB="ar s"
w32debug:
	$(MAKE) all -f Makefile.emx \
	CC="gcc -g" O=".o" A=".a" AR="ar" RANLIB="ar s"

PRODUCT = m4
VERSION = 1.4

AWK = gawk

CFLAGS = -DHAVE_CONFIG_H

OBJECTS = m4$O input$O output$O symtab$O builtin$O macro$O \
	debug$O eval$O path$O format$O freeze$O

MDEFINES = CC="$(CC)" O="$(O)" A="$(A)" CFLAGS="$(CFLAGS)" \
	AR="$(AR)" RANLIB="$(RANLIB)" AWK="$(AWK)" LFLAGS="$(LFLAGS)"

.SUFFIXES: .c $O

.c$O:
	$(CC) -c $(CFLAGS) -I. -I.. -I../lib $<

.PHONY: all ../lib/m4$A ../lib/regex.lib
all: m4.exe

m4.exe: $(OBJECTS) ../lib/m4$A $(LIBS) m4.def
	$(CC) -o $@ $(OBJECTS) ../lib/m4$A $(LFLAGS) $(LIBS) m4.def

$(OBJECTS): m4.h ../lib/obstack.h
builtin$O: ../lib/regex.h

../lib/m4$A:
	cd .. & cd lib & $(MAKE) -f Makefile.emx $(MDEFINES) m4$A

../lib/regex$A:
	cd .. & cd lib & $(MAKE) -f Makefile.emx $(MDEFINES) regex$A

check: m4.exe
	cd .. & cd checks & $(MAKE) $(MDEFINES) check
